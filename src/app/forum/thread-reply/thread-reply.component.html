<div class="card py-3 w-100 border mt-1" *ngIf="reply" (click)="clicked($event)">
  <div class="container-fluid w-100">
    <div class="row">
      <div class="col-2 col-lg-1 justify-content-center">
        <img [src]="profileImageSrc" class="w-100 rounded-circle m-auto" (error)="imgError()" />
      </div>
      <div class="col-10 col-lg-11">
        <div class="row">
          <div class="col-12">
            <a
              (click)="visitProfile()"
              [class]="{ pointer: reply.account.profileId !== undefined }"
              class="text-dark"
              >{{ reply.account.username }}</a
            ><span *ngIf="author && author === reply.account.username" class="author-tag ml-2">Author</span
            >&nbsp;&nbsp;&nbsp;&nbsp;<small class="text-muted">{{ getParsedDate() }}</small
            ><small *ngIf="isOwnReply"
              >&nbsp;&nbsp;&nbsp; - &nbsp;&nbsp;&nbsp;<a [routerLink]="'/forum/edit-reply/' + reply.id">Edit</a
              >&nbsp;&nbsp;&nbsp; - &nbsp;&nbsp;&nbsp;<a href="javascript: void(0)" (click)="removeOwnReply()"
                >Remove</a
              ></small
            >
          </div>
          <div class="col-12">
            <div class="row mt-2" *ngIf="reply.replyingToUsername && reply.replyingToText">
              <div class="col-12">
                <div class="replying-to-container shadow-sm w-100 py-2 px-3 rounded">
                  <span>{{ reply.replyingToUsername }} said:</span><br />
                  <i class="text-muted">{{ reply.replyingToText }}</i>
                </div>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-12 inner-text" [innerHTML]="reply.body" (mouseup)="doSomethingWithSelectedText()"></div>
            </div>
            <button
              class="btn btn-secondary selected-txt-btn mt-4 w-100"
              *ngIf="textSelected"
              (click)="replyToSelected()"
            >
              Reply To Selected Text
            </button>
            <div class="row">
              <div class="col-12 text-right">
                <p class="text-right text-muted my-0" *ngIf="reply.edited"><small>(edited)</small></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row mt-4 text-center">
      <div class="col-4">
        <i class="bi bi-reply text-muted pointer" (click)="clickReply()"></i>
      </div>
      <div class="col-4">
        <i
          class="bi bi-heart-fill heart-icon pointer"
          [class]="{
            'text-danger': userHasLiked,
            'text-muted': !userHasLiked
          }"
          (click)="likeUnlikeReply()"
        ></i
        >&nbsp;&nbsp;{{ reply.likes }}
      </div>
      <div class="col-4">
        <i class="bi bi-flag-fill pointer text-muted" title="Report This Thread" (click)="openModal(reportModal)"></i>
      </div>
    </div>
  </div>
</div>

<ng-template #reportModal let-reportModal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title-report">Report This Reply</h4>
    <button type="button" class="close" aria-label="Close" (click)="reportModal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="form-group">
      <label for="report-body"
        >Why are you reporting this reply?<br /><small
          >Please include as much detail as possible so that staff can accurately assess whether to remove the reply,
          and/or take administrative action against the poster (if necessary).</small
        ></label
      >
      <textarea class="form-control" id="report-body" rows="4" [(ngModel)]="reportDescription"></textarea>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="reportModal.close('Save click')">Close</button>
    <button
      class="btn btn-secondary"
      (click)="reportReply()"
      [disabled]="reportDescription === '' || !reportDescription || submittingReport"
    >
      Report Reply
    </button>
  </div>
</ng-template>
